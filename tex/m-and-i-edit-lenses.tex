\documentclass[a4paper,10pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{color}
\usepackage{mathpartir}

\newtheorem{definition}{Definition}
\newtheorem{note}{Note}

\newcommand{\finish}[1]{#1}
\newcommand{\comment}[1]{\finish{\textbf{\textcolor{red}{#1}}}}
\newcommand{\jnf}[1]{\finish{\textbf{\textcolor{blue}{[#1---JNF]}}}}
\newcommand{\raghu}[1]{\finish{\textbf{\textcolor{blue}{[#1---Raghu]}}}}

\newcommand{\defeq}{\ensuremath{\stackrel{\Delta}{=}}}
\newcommand{\Unit}{\ensuremath{\mathbf{Unit}}}

%opening
\title{}
\author{}

\input{diagrams.sty}

\begin{document}

\maketitle

\section{Opfibrations}

\begin{definition}[Opcartesian Lifting] \label{opcartesian}
  Let $p : I \to X$ be a functor. A morphism $f : A \to B$ in $I$ is opcartesian if for all morphisms $g : A \to C$ in $I$ and $v : pB \to pC$ in $X$ such that $v \cdot pf = pg$, there exists a unique morphism $h : B \to C$ satisfying $h \cdot f = g$
\end{definition}

\begin{figure}[ht]
\begin{displaymath}
\begin{diagram}
    &    &              & C \\
  I &    & \ruTo^g      & \uDashto_h  \\
    & A  & \rTo_f       & B \\
    &    & \dImplies_p  &   \\
    &    & ~            & pC  \\
  X &    & \ruTo^{pg}   & \uTo_v  \\    
    & pA & \rTo_{pf}    & pB  
\end{diagram}
\end{displaymath}
\caption{Opcartesian Lifting}    
\label{fig:opcartesian}
\end{figure}

\begin{definition}[Opfibration] \label{opfibration} 
  A functor $p : I \to X$ is an opfibration if for all morphisms $u :
  pA \to T$ in $X$, there is an opcartesian morphism $f : A \to B$ in
  $I$ such that $f = pu$.
\end{definition}

\begin{note}[Intuition for opcartesian lifting being minimal]
  Let $f : X \to Y$ be the opcartesian lifting of $u$. Let $g : X \to
  Y$ be another morphism such that $pg = u$. Then, $g$ factors through
  $f$. This can be observed (see Figure \ref{fig:intuition}) as a case
  of the opcartesian property where $B = C$ and $v = id$.
\end{note}

\begin{figure}[ht]
\begin{displaymath}
\begin{diagram}
    &    &              & B \\
  I &    & \ruTo^g      & \uDashto_h  \\
    & A  & \rTo_f       & B \\
    &    & \dImplies_p  &   \\
    &    & ~            & pB \\
  X &    & \ruTo^{u = pg}   & \uTo_{v = id}   \\    
    & pA & \rTo_{u = pf}    & pB
\end{diagram}
\end{displaymath}
\caption{Minimality of opcartesian lifting}
\label{fig:intuition}
\end{figure}

\begin{definition}[Pullback]
The pullback (see figure \ref{fig:pullback}) of morphisms $f: X \to C$ and $g: Y \to C$ is defined as
an object $I$ with two morphisms $i_1: I \to X$ and $i_2: I \to Y$
such that 
\begin{enumerate}
\item Diagram commutes i.e. $f . i_1 = g. i_2$
\item For any other object $Z$ with morphisms $z_1: Z \to X$ and $z_2:
  Z \to Y$ which makes the diagram commute i.e $f. z_1 = g. z_2$ then
  there exists a unique $u$ such that $ i_1 . u = z_1$ and $ i_2 . u = z_2$.
\end{enumerate}
\begin{figure}[ht]
\begin{displaymath}
\begin{diagram}
  Z  &    &    &  & \\
      & \rdDashto^u  \rdTo(4,2)^{z_2} \rdTo(2,4)^{z_1}  &  &  \\
      &    & I               & \rTo^{i_2} & Y \\
      &    & \dTo_{i_1} &                & \dTo^g  \\
      &    & X              & \rTo_f     & C
\end{diagram}
\end{displaymath}
\caption{Pullback}
\label{fig:pullback}
\end{figure}


\end{definition}
\section{Category-theoretic Model of lenses}
\begin{itemize}
 \item Categories are types equipped with a monoid of updates. Objects of the category are values, and morphisms between objects are updates corresponding to the monoid action. Thus, the pair of a source object and update corresponds to a single morphism. 
 \item Asymmetric Lenses are opfibrations (functors) between categories.
 \item A correspondence between two categories is specified by its ``l-diagram''. In the simple case (no state), the l-diagram is just $X \to X \cap Y \leftarrow Y$.
 \item Every l-diagram has a limit, defined the \emph{ideal}. 
 \item A symmetric I-lens between categories X and Y consists of asymmetric lenses between X and I, and Y and I; where I is the ideal of the l-diagram of X and Y.
\end{itemize}

\section{Prisms}
\begin{definition}[Categorical]
 An ideal prism $l$ between categories $I$ and $X$ is an opfibration $l : I \Rightarrow X$.
\end{definition}

\begin{definition} [\comment{TODO Module}]
 
\end{definition}

\begin{definition}[Concrete]
 An ideal prism $l$ between modules $I$ and $X$ consists of the following functions
 \begin{itemize}
  \item $get_0 : I \to X$
  \item $get_1 : dI \times I \rightharpoonup dX$
  \item $put : dX \to dI$
 \end{itemize}
 satisfying the following laws
 \begin{mathpar}
   \inferrule*
     {di \cdot i \textnormal{ is defined}}
     {get_1 (di, i) \textnormal{ is defined}  }
     
  \inferrule*
     {get_0 ~ i = x \\ get_0 ~ i' = x' \\\\
      di \cdot i = i' \\ get_1 (di, i) = dx}
     {dx \cdot x = x'}
     
 \end{mathpar}

\end{definition}

\section{Ideal Lenses}
\begin{definition}
 An ideal lens $l : X \leftrightarrow Y$ consists of 
 \begin{enumerate}
  \item an ideal $I$ 
  \item Two ideal prisms $k : I \Rightarrow X$ and $l : I \Rightarrow Y$
\end{enumerate}
\end{definition}




\section{I-lenses in a local setting}
  Thinking of the ideal $I$ as isomorphic to $X \times Y \times C$, where $C$ is the type of lens state, it may be superior to have the ideal materialized, instead of $X$, $Y$, and $C$. 

\section{I-lenses in a distributed setting}

\section{Questions}
\begin{enumerate}
 \item Labeled morphisms. $dX \times I \to dI, dI \to dY$ versus $lX \to lI, lI \times I \to lY$.
 \item Composing opfibrations. Can we have a lifting $(I \to dI) \to (I' \to dI')$.
 \item The ideal is not something that is intuitive to a lens designer. Instead, the l-diagram can be a more intuitive thing, from which we can perhaps construct the ideal.
\end{enumerate}



\end{document}
